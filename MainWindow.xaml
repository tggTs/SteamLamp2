<Window x:Class="SteamLamp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Steam Lamp" Height="650" Width="1100"
        WindowStyle="None" 
        AllowsTransparency="True" 
        Background="Transparent"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <Style x:Key="WindowControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3e434a"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource WindowControlButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#e81123"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="SteamMenuButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="LightGray"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="Padding" Value="0,0,0,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Background="Transparent">
                            <StackPanel>
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,2"/>
                                <Border x:Name="Underline" Height="2" Background="#66c0f4" Visibility="Collapsed"/>
                            </StackPanel>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="Tag" Value="Selected">
                                <Setter Property="Foreground" Value="#66c0f4"/>
                                <Setter TargetName="Underline" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Border Background="#1b2838" BorderBrush="#2a2e33" BorderThickness="1" ClipToBounds="True" CornerRadius="20">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="64"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="35"/>
            </Grid.RowDefinitions>
            <Border Grid.Row="0" Background="#2a2e33" MouseLeftButtonDown="Header_MouseDown" Panel.ZIndex="1">
                <Grid>
                    <StackPanel x:Name="MainMenuStack" Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0,15,0" Height="47">
                        <TextBlock Text="STEAMLAMP" Foreground="White" FontWeight="Bold" VerticalAlignment="Top" Margin="0,0,20,0"/>

                        <Button x:Name="BtnStore" Content="МАГАЗИН" Style="{StaticResource SteamMenuButtonStyle}" 
                                Margin="-60,20,15,0" Cursor="Hand" Click="OpenStore_Click"/>

                        <Button x:Name="BtnLibrary" Content="БИБЛИОТЕКА" Style="{StaticResource SteamMenuButtonStyle}" 
                                Margin="0,20,15,0" Cursor="Hand" FontSize="21" Click="OpenLibrary_Click"/>

                        <Button x:Name="BtnProfile" Content="ПРОФИЛЬ" Style="{StaticResource SteamMenuButtonStyle}" 
                                Margin="0,20,15,0" Cursor="Hand" Click="OpenProfile_Click"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
                        <Button x:Name="AccountMenuButton" 
                                Content="NickNAME ▼" 
                                Foreground="#919499" 
                                FontSize="13" 
                                Background="Transparent" 
                                BorderThickness="0" 
                                Margin="0,0,10,0" 
                                Padding="10,5"
                                VerticalAlignment="Center"
                                Cursor="Hand" 
                                Click="AccountMenuButton_Click"/>

                        <Button Content="—" Click="MinimizeApp_Click" Style="{StaticResource WindowControlButtonStyle}"/>
                        <Button x:Name="MaximizeBtn" Content="⬜️" Click="MaximizeApp_Click" Style="{StaticResource WindowControlButtonStyle}" FontSize="12"/>
                        <Button Content="✕" Click="CloseApp_Click" Style="{StaticResource CloseButtonStyle}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Row="1" Background="#1b2838">
                <ContentControl x:Name="MainContentFrame">
                    <Grid x:Name="DefaultStoreView">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock Text="Магазин скоро будет здесь..." Foreground="Gray" FontSize="20"/>
                        </StackPanel>
                    </Grid>
                </ContentControl>
            </Grid>

            <Border Grid.Row="2" Background="#171a21">
                <Grid Margin="10,0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="ЗАГРУЗКИ" Foreground="#66c0f4" FontSize="11" VerticalAlignment="Center"/>
                        <ProgressBar Value="99" Width="100" Height="4" Margin="10,0" Foreground="#66c0f4" Background="#3d4450" BorderThickness="0">
                            <ProgressBar.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever" AutoReverse="True">
                                            <DoubleAnimation Storyboard.TargetProperty="Value" From="0" To="100" Duration="0:0:1" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </ProgressBar.Triggers>
                        </ProgressBar>
                        <TextBlock Text="%" FontSize="16" Foreground="#66c0f4" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                            <TextBlock.RenderTransform>
                                <RotateTransform Angle="0" />
                            </TextBlock.RenderTransform>
                            <TextBlock.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                             From="0" To="360" Duration="0:0:1" />
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </TextBlock.Triggers>
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>

            <Popup x:Name="AccountPopup" 
                   PlacementTarget="{Binding ElementName=AccountMenuButton}" 
                   Placement="Bottom" 
                   StaysOpen="False" 
                   AllowsTransparency="True" 
                   HorizontalOffset="-100"
                   VerticalOffset="5">
                <Border Background="#2a2e33" BorderBrush="#1b2838" BorderThickness="1" Width="180" CornerRadius="5">
                    <StackPanel Margin="10">
                        <TextBlock x:Name="UserBalanceText" Text="Баланс: 0.00 руб." Foreground="#66c0f4" FontSize="12" Margin="0,0,0,10"/>
                        <Separator Background="#3e434a" Margin="0,5"/>
                        <Button Content="Об аккаунте" Foreground="LightGray" Background="Transparent" BorderThickness="0" HorizontalAlignment="Left" Cursor="Hand" Margin="0,5"/>
                        <Button Content="Настройки" Foreground="LightGray" Background="Transparent" BorderThickness="0" HorizontalAlignment="Left" Cursor="Hand" Margin="0,5"/>
                        <Separator Background="#3e434a" Margin="0,5"/>
                        <Button Content="Выйти из аккаунта" Click="Logout_Click" Foreground="#e81123" Background="Transparent" BorderThickness="0" HorizontalAlignment="Left" Cursor="Hand" Margin="0,5"/>
                    </StackPanel>
                </Border>
            </Popup>
        </Grid>
    </Border>
</Window>